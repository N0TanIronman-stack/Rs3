<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rs3 Stats Detector</title>
  <link rel="stylesheet" type="text/css" href="https://runeapps.org/nis/nis.css">
  <script src="https://runeapps.org/alt1lib.js"></script>
</head>
<body class="nis">
  <!-- Main Border Container -->
  <div class="nismainborder nisborder" style="padding: 20px; position: relative;">
    <h2>Alt1 Stats Detector</h2>
    <button onclick="startFinder()">Start Stats Finder</button>
    <div id="output" style="margin-top:10px; font-weight:bold; color:lime;"></div>
  </div>

  <script>
    let statsReader = new a1lib.ImageDetect("./statanchor.png");
    let statsPos = null;
    let findStats = null;

    // Ensure Alt1 is ready before we do anything
    a1lib.on("ready", () => {
      if (window.alt1) {
        alt1.overLayText("Alt1 detected!", a1lib.mixcolor(0, 255, 0), 30, 200, 200, 3000);
        console.log("Alt1 detected âœ…");
        document.getElementById("output").innerText = "Alt1 detected!";
      } else {
        alert("This app must be run inside the Alt1 client!");
      }
    });

    function startFinder() {
      if (!window.alt1) {
        alert("Not running in Alt1!");
        return;
      }

      if (!alt1.permissionPixel) {
        alert("Pixel permission not granted! Check Alt1 settings.");
        return;
      }

      statsReader.load().then(() => {
        console.log("Anchor loaded, w:", statsReader.img.width, "h:", statsReader.img.height);
        document.getElementById("output").innerText = "Anchor image loaded. Searching...";

        // For debugging: overlay the anchor image on screen at (200,200) so you can see it
        statsReader.overLay(200, 200, 5000);

        findStats = setInterval(function () {
          statsReader.find().then(matches => {
            if (matches.length > 0) {
              statsPos = matches[0];
              clearInterval(findStats);

              alt1.overLayRect(a1lib.mixcolor(255, 0, 0), statsPos.x, statsPos.y, 150, 200, 5000, 3);
              alt1.overLayText("Stats Found", a1lib.mixcolor(255, 255, 0), 20, statsPos.x, statsPos.y - 25, 5000);

              document.getElementById("output").innerText =
                "Stats window found at X: " + statsPos.x + " Y: " + statsPos.y;
              console.log("Stats window found:", statsPos);
            } else {
              document.getElementById("output").innerText = "Searching for stats window...";
            }
          });
        }, 1000);
      }).catch(err => {
        console.error("Error loading anchor:", err);
        document.getElementById("output").innerText = "Error loading anchor image.";
      });
    }
  </script>
</body>
</html>
