<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RS3 Stats Detector</title>
  <link rel="stylesheet" type="text/css" href="https://runeapps.org/nis/nis.css">
  <script src="https://runeapps.org/alt1lib.js"></script>
  <style>
    #status {
      margin-top: 10px;
      font-weight: bold;
      color: lime;
    }
  </style>
</head>
<body class="nis">
  <div class="nismainborder nisborder" style="padding: 20px; position: relative;">
    <h2>RS3 Stats Detector</h2>
    <button onclick="startFinder()">Start Stats Finder</button>
    <div id="status">Waiting…</div>
  </div>

  <script>
    function setStatus(msg, color = "lime") {
      const el = document.getElementById("status");
      el.innerText = msg;
      el.style.color = color;
      console.log(msg);
    }

    // Confirm Alt1
    a1lib.on("ready", () => {
      if (window.alt1) {
        setStatus("Alt1 detected ✅");
        alt1.overLayText("Alt1 ready", a1lib.mixcolor(0, 255, 0), 20, 200, 200, 3000);
      } else {
        setStatus("Not running in Alt1 ❌", "red");
      }
    });

    function startFinder() {
      if (!window.alt1) {
        setStatus("Not running in Alt1 ❌", "red");
        return;
      }
      if (!alt1.permissionPixel) {
        setStatus("Pixel permission not granted ❌", "red");
        return;
      }

      setStatus("Scanning screen for stats window…");

      // Example: scan a fixed region (adjust these numbers as needed)
      let regionX = 1000, regionY = 100, regionW = 300, regionH = 500;
      let pixels = alt1.getPixels(regionX, regionY, regionW, regionH);

      let found = false;

      // Scan for a strong red pixel (Hitpoints heart)
      setStatus("Looking for Heart Icon");
      for (let i = 0; i < pixels.length; i += 4) {
        let r = pixels[i], g = pixels[i+1], b = pixels[i+2];
        if (r > 180 && g < 80 && b < 80) {
          found = true;
          setStatus("Heart Found");
          let px = (i / 4) % regionW;
          let py = Math.floor((i / 4) / regionW);

          // Overlay box where found
          alt1.overLayRect(
            a1lib.mixcolor(255, 0, 0),
            regionX + px - 5, regionY + py - 5,
            20, 20,
            5000, 3
          );
          setStatus(`Stats window detected at ~X:${regionX+px}, Y:${regionY+py}`);
          break;
        }
      }

      if (!found) {
        setStatus("Could not detect stats window ❌", "red");
      }
    }
  </script>
</body>
</html>
